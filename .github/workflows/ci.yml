name: CI

# Control when the action will run.
# Controls which branches, tags, or events trigger the workflow.
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# Allows you to run this workflow manually from the Actions tab.
workflow_dispatch: {} 

# A workflow run is made up of one or more jobs that can run sequentially or in parallel.
jobs:
  # This is a single job called "build".
  build:
    # The type of runner that the job will run on.
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job.
    # Steps can be used to download a checkout of a repository, run a script, or execute commands.
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it.
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Set up Node.js environment for building browser extensions.
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use a recent LTS version compatible with build tools
          cache: 'npm' # Cache npm dependencies to speed up subsequent runs

      # Install project dependencies using npm.
      - name: Install Dependencies
        run: npm ci # 'ci' is recommended for CI environments for faster, more reliable installs

      # Run linters and formatters to ensure code quality and consistency.
      # For a JavaScript project, this typically involves ESLint and Prettier, or Biome.
      # Assuming common tools or a script that runs them.
      - name: Lint and Format Check
        run: npm run lint # Assumes an npm script 'lint' exists to run linters/formatters

      # Run unit tests to verify the functionality of individual components.
      - name: Run Unit Tests
        run: npm test # Assumes an npm script 'test' exists to run unit tests (e.g., using Jest, Vitest)

      # Build the browser extension.
      # This step compiles the code and prepares it for packaging.
      - name: Build Extension
        run: npm run build # Assumes an npm script 'build' exists for the extension build process

      # Optional: Upload build artifacts for later use or inspection.
      # This can be useful for downloading the compiled extension zip file.
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tabguard-extension-build
          path: dist/ # Adjust path if your build output is in a different directory
